<div class="container mt-4">
  <div class="row mb-4">
    <div class="col">
      <h2>Add New Prescription</h2>
      <p class="text-muted">Create a new prescription for a patient</p>
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-secondary" (click)="goBack()">
        <i class="bi bi-arrow-left me-2"></i>Back to List
      </button>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div *ngIf="loading" class="d-flex justify-content-center my-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <div *ngIf="error" class="alert alert-danger" role="alert">
        {{ error }}
      </div>

      <div *ngIf="success" class="alert alert-success" role="alert">
        {{ success }}
      </div>

      <form [formGroup]="prescriptionForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
        <div class="row mb-3">
          <div class="col-md-6">
            <label for="patientId" class="form-label">Patient ID*</label>
            <input 
              type="number" 
              class="form-control" 
              id="patientId" 
              formControlName="patientId"
              [ngClass]="{'is-invalid': prescriptionForm.get('patientId')?.invalid && prescriptionForm.get('patientId')?.touched}"
            >
            <div class="invalid-feedback" *ngIf="prescriptionForm.get('patientId')?.errors?.['required']">
              Patient ID is required.
            </div>
            <div class="invalid-feedback" *ngIf="prescriptionForm.get('patientId')?.errors?.['pattern']">
              Patient ID must be a number.
            </div>
          </div>
          
          <div class="col-md-6">
            <label for="patientName" class="form-label">Patient Name*</label>
            <input 
              type="text" 
              class="form-control" 
              id="patientName" 
              formControlName="patientName"
              [ngClass]="{'is-invalid': prescriptionForm.get('patientName')?.invalid && prescriptionForm.get('patientName')?.touched}"
            >
            <div class="invalid-feedback" *ngIf="prescriptionForm.get('patientName')?.errors?.['required']">
              Patient name is required.
            </div>
            <div class="invalid-feedback" *ngIf="prescriptionForm.get('patientName')?.errors?.['minlength']">
              Patient name must be at least 2 characters.
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="medicationName" class="form-label">Medication Name*</label>
            <input 
              type="text" 
              class="form-control" 
              id="medicationName" 
              formControlName="medicationName"
              [ngClass]="{'is-invalid': prescriptionForm.get('medicationName')?.invalid && prescriptionForm.get('medicationName')?.touched}"
            >
            <div class="invalid-feedback" *ngIf="prescriptionForm.get('medicationName')?.errors?.['required']">
              Medication name is required.
            </div>
          </div>
          
          <div class="col-md-6">
            <label for="dosage" class="form-label">Dosage*</label>
            <input 
              type="text" 
              class="form-control" 
              id="dosage" 
              formControlName="dosage"
              [ngClass]="{'is-invalid': prescriptionForm.get('dosage')?.invalid && prescriptionForm.get('dosage')?.touched}"
              placeholder="e.g., 500mg"
            >
            <div class="invalid-feedback" *ngIf="prescriptionForm.get('dosage')?.errors?.['required']">
              Dosage is required.
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="frequency" class="form-label">Frequency*</label>
            <input 
              type="text" 
              class="form-control" 
              id="frequency" 
              formControlName="frequency"
              [ngClass]="{'is-invalid': prescriptionForm.get('frequency')?.invalid && prescriptionForm.get('frequency')?.touched}"
              placeholder="e.g., Once daily"
            >
            <div class="invalid-feedback" *ngIf="prescriptionForm.get('frequency')?.errors?.['required']">
              Frequency is required.
            </div>
          </div>
          
          <div class="col-md-6">
            <label for="prescribedBy" class="form-label">Prescribed By*</label>
            <input 
              type="text" 
              class="form-control" 
              id="prescribedBy" 
              formControlName="prescribedBy"
              [ngClass]="{'is-invalid': prescriptionForm.get('prescribedBy')?.invalid && prescriptionForm.get('prescribedBy')?.touched}"
              placeholder="e.g., Dr. Smith"
            >
            <div class="invalid-feedback" *ngIf="prescriptionForm.get('prescribedBy')?.errors?.['required']">
              Prescriber name is required.
            </div>
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label for="prescriptionDate" class="form-label">Prescription Date*</label>
            <input 
              type="date" 
              class="form-control" 
              id="prescriptionDate" 
              formControlName="prescriptionDate"
              [ngClass]="{'is-invalid': prescriptionForm.get('prescriptionDate')?.invalid && prescriptionForm.get('prescriptionDate')?.touched}"
            >
            <div class="invalid-feedback" *ngIf="prescriptionForm.get('prescriptionDate')?.errors?.['required']">
              Prescription date is required.
            </div>
          </div>
          
          <div class="col-md-6">
            <label for="endDate" class="form-label">End Date</label>
            <input 
              type="date" 
              class="form-control" 
              id="endDate" 
              formControlName="endDate"
            >
          </div>
        </div>

        <div class="mb-3">
          <label for="notes" class="form-label">Notes</label>
          <textarea 
            class="form-control" 
            id="notes" 
            formControlName="notes"
            rows="3"
            placeholder="Additional instructions or notes"
          ></textarea>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary" [disabled]="loading">
            <i class="bi bi-save me-2"></i>Save Prescription
          </button>
          <button type="button" class="btn btn-outline-secondary" (click)="resetForm()" [disabled]="loading">
            <i class="bi bi-x-circle me-2"></i>Reset Form
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
